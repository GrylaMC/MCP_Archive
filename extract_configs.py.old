"""
Go through and extract all the configs.


NOTE: DURING CLEANUP EFFORTS THINGS WERE RENAME. SO THIS WILL NOT
      GIVE YOU IDENTICAL FILE STRUCTURES




Copyright (C) 2025 - PsychedelicPalimpsest


This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.

"""
import subprocess, os
import sys




for x in os.listdir("complete_packs"):
    for z in os.listdir(os.path.join("complete_packs", x)):

        extra = []
        sep = '/'
        if z in ["mcp20.zip", "mcp20a.zip", "mcp23.zip", "mcp21.zip", "mcp25.zip", "mcp24.zip"]:
            extra = []
            sep = '\\\\'
        if x == "a1.1.2" and z != "revengpack16.zip":
            continue

        if x == "a1.1.2" and z == "revengpack16.zip":
            sep = '\\\\'


        out = os.path.join("configs", x, z.split(".")[0])
        os.makedirs(out)
        p = subprocess.Popen(["unzip",
                  "-j", '-q', *extra,
                    os.path.join("complete_packs", x, z),
                    f'conf{sep}*',
                    "-x", f"conf{sep}*{sep}",'*.patch',
                     "-d", 
                     out
                ], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        p.wait()
        if len(os.listdir(out)) == 0:
            print("Error on", x, z)
            sys.stdout.buffer.write(p.stderr.read())
